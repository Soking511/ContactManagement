@if ( !this.contactsService.isUserIdle()){

<div class="container mx-auto px-4 py-6 space-y-6 min-w-7xl">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-bold text-gray-900">Contacts</h2>
    <app-button
      [icon]="'add'"
      [cooldown]="'1'"
      (buttonClick)="toggles.create = true"
    >
      Add
    </app-button>
  </div>

  <!-- Search and Filters -->
  <div class="bg-white rounded-lg shadow-sm p-4 space-y-4">
    <div class="flex items-center gap-4">
      <div class="flex-1 relative">
        <input
          #searchInput
          type="search"
          placeholder="Search"
          class="w-full h-10 pl-10 pr-4 text-sm border rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        />
      </div>
    </div>
  </div>

  <!-- Table -->
  <div
    class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg min-h-[320px]"
  >
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <th
            scope="col"
            class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"
          >
            Name
          </th>
          <th
            scope="col"
            class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
          >
            Email
          </th>
          <th
            scope="col"
            class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
          >
            Phone
          </th>
          <th
            scope="col"
            class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
          >
            Address
          </th>
          <th
            scope="col"
            class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
          >
            Notes
          </th>
          <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
            <span class="sr-only">Actions</span>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        @for (contact of contacts(); track contact._id) {
        <tr>
          <td
            class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"
          >
            {{ contact.name }}
          </td>
          <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
            {{ contact.email }}
          </td>
          <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
            {{ contact.phone }}
          </td>
          <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
            {{ contact.address?.country }} - {{ contact.address?.city }} -
            {{ contact.address?.street }}
          </td>
          <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
            {{ contact.notes }}
          </td>
          <td
            class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"
          >
            <button
              (click)="toggles.delete = true; selectedContact.set(contact)"
              class="text-red-600 hover:text-red-900"
            >
              Delete
            </button>
          </td>
        </tr>
        } @empty {
        <tr>
          <td colspan="4" class="py-4 text-center text-sm text-gray-500">
            No contacts found
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Create Contact Popup -->
    <app-contacts-form [toggleCreate]="toggles.create" (closedCreateContactForm)="toggles.create = false" />

  <!-- Delete Contact Popup -->
  <app-popup
    [isOpen]="toggles.delete"
    (closePopup)="toggles.delete = false"
    title="Contact Delete"
    [showConfirmButton]="true"
    (confirmPopup)="onDeleteConfirm()"
  >
    <div class="flex items-center gap-2 text-red-500">
      <span class="material-icons">error_outline</span>
      <p>{{ selectedContact()?.name }}</p>
    </div>
  </app-popup>

  <!-- Footer Pagination -->
  <div class="flex justify-between items-center">
    <app-pagination
      [pagination]="this.contactsService.pagination!"
      (pageChanged)="onPageChange($event)"
    />
  </div>
</div>

} @else {
  <app-session-timeout/>
}